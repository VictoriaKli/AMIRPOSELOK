
@@include('include/header.html')
<section class="homescreen js-homescreen">
    <div class="swiper js-homescreen-slider">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <div class="homescreen__slide-bg">
                    <picture>
                        <source srcset="./img/content/homescreen1-mob.png" media="(max-width: 768px)">
                        <img src="./img/content/homescreen1.png" alt="" title="">
                    </picture>
                </div>
               <div class="container">
                    <div class="homescreen__slide">
                        <div class="homescreen__slide-info">
                        <h1>
                            Транспортная доступность
                       </h1>
                       <div class="homescreen__slide-content">
                            <ul>
                                <li>
                                    Коттеджный поселок «Бобров Ручей»  расположен в 70 км от МКАД
                                </li>
                                <li>
                                    Подъезд к поселку имеется с двух шоссе: Киевское и Можайское
                                </li>
                            </ul>
                       </div>
                        </div>
                    </div>
               </div>
            </div>
            <div class="swiper-slide">
                <div class="homescreen__slide-bg">
                    <picture>
                        <source srcset="./img/content/homescreen2-mob.png" media="(max-width: 768px)">
                        <img src="./img/content/homescreen2.png" alt="" title="">
                    </picture>
                </div>
                <div class="container">
                    <div class="homescreen__slide">
                        <div class="homescreen__slide-info">
                            <h1>
                                доступность
                            </h1>
                            <div class="homescreen__slide-content">
                                Коттеджный поселок «Бобров Ручей»  расположен в 70 км от МКАД
                                Подъезд к поселку имеется с двух шоссе: Киевское и Можайское
                            </div>
                        </div>
                     </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="swiper-pagination"></div>
            <div class="homescreen__navigation js-homescreen-navigation">
                <div class="swiper-button-prev">
                    <svg class="icon icon-arrow-prev"><use xlink:href="#icon-arrow-prev"></use></svg>
                </div>
                <div class="swiper-button-next">
                    <svg class="icon icon-arrow-next"><use xlink:href="#icon-arrow-next"></use></svg>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="section about-mp js-animation1">
    <div class="container">
        <div class="section__heading">
            <div class="section__title-wp">
                <div class="section__subtitle">О посёлке</div>
                <h2 class="section__title">КП Бобров ручей</h2>
            </div>
        </div>
        <div class="about-mp__wp">
            <div class="about-mp__wp-leftside">
                <div class="about-mp__animation-block">
                    <div class="about-mp__animation-block-icon">
                        <img src="./img/svg/about.svg" alt="" title="" loading="lazy">
                    </div>
                    <div class="about-mp__animation-block-text">
                        Доступно два направления: <br>
                        <span>Киевское и Можайское шоссе</span>
                    </div>
                </div>
            </div>
            <div class="about-mp__wp-rightside content">
                <p class="big-text">
                    Находится в удобной транспортной доступности от МКАД по Киевскому шоссе, а само Киевское направление считается благополучным и экологически чистым.
                </p>
                <p>
                    КП Бобров ручей – это идеальным выбор как для спокойного загородного отдыха с семьей, так и для постоянного проживания в окружении лесного массива и отдалёния от шумных дорог и крупных городов.
                </p>
            </div>
        </div>
    </div>
</section>
<section class="section about-img js-animation2">
    <div class="about-img__wp">
        <picture>
             <source srcset="./img/content/about-bg-md.png" media="(max-width: 1440px)">
             <img src="./img/content/about-bg.png" alt="" title="" loading="lazy">
        </picture>
    </div>
    <div class="container">
        <div class="about-img__content">
            <div class="about-img__text content">
                <blockquote class="white">
                    <p class="big-text">
                        В лесном массиве, который окружает поселок, изобилие дичи, ягод и грибов. Здесь каждый найдет себе занятие по душе.
                    </p>
                    <p>
                        А в летнюю жару можно провести время на берегу живописного ручья.
                    </p>
                </blockquote>
            </div>
            <div class="about-img__img" style="background: url('./img/content/about.png');">
            </div>
        </div>
    </div>
</section>
<section class="section advan-mp">
    <div class="container">
        <div class="advan-mp__wp">
            <div class="advan__item">
                <div class="advan__item-text">
                    Необходимые коммуникации <br>
                    <span>для комфортной жизни</span>
                </div>
                <div class="advan__item-icon">
                    <img src="./img/svg/plus1.svg" alt="" title="" loading="lazy">
                </div>
            </div>
            <div class="advan__item">
                <div class="advan__item-text">
                    Закрытая территория, <br>
                    <span> видеонаблюдение <br> и охрана </span>
                </div>
                <div class="advan__item-icon">
                    <img src="./img/svg/plus2.svg" alt="" title="" loading="lazy">
                </div>
            </div>
        </div>
    </div>
</section>
<section class="section menu-block">
    <div class="container">
        <div class="menu-block__wp">
            <a href="#" class="menu-block__item menu-block__item--width">
                <picture>
                    <source srcset="./img/content/men1-mob.png" media="(max-width: 991px)">
                    <img src="./img/content/men1.png" alt="" title="" loading="lazy" class="menu-block__item-img">
               </picture>

                <div class="menu-block__item-text">Галерея</div>
            </a>
            <a href="#" class="menu-block__item">
                <img src="./img/content/men2.png" alt="" title="" loading="lazy" class="menu-block__item-img">
                <div class="menu-block__item-text">Ход строительства</div>
            </a>
            <a href="#" class="menu-block__item">
                <img src="./img/content/men3.png" alt="" title="" loading="lazy" class="menu-block__item-img">
                <div class="menu-block__item-text">Акции</div>
            </a>
            <a href="#" class="menu-block__item">
                <img src="./img/content/men1.png" alt="" title="" loading="lazy" class="menu-block__item-img">
                <div class="menu-block__item-text">Новости</div>
            </a>
            <a href="#" class="menu-block__item">
                <img src="./img/content/men4.png" alt="" title="" loading="lazy" class="menu-block__item-img">
                <div class="menu-block__item-text">Застройщик</div>
            </a>
        </div>
    </div>
</section>
<section class="section location-mp">
    <div class="container">
        <div class="section__heading">
            <div class="section__title-wp">
                <h2 class="section__title">Расположение</h2>
            </div>
        </div>
    </div>
    <div class="location-mp__map-wp">
        <div class="location-mp__map js-map" id="map"></div>
        <div class="container">
            <div class="location-mp__map-filter-wp">
                <div class="location-mp__map-filter  js-map-filter">
                    <div class="location-mp__map-filter-item">
                        <input id="map1" data-type="sport" type="checkbox" class="location__filter-input js-map-filter-input">
                        <label for="map1" class="location__filter-label">
                            <div class="location-mp__map-filter-item-icon">
                                <svg class="icon icon-map1"><use xlink:href="#icon-map1"></use></svg>
                            </div>
                            ­­Спорт
                        </label>
                    </div>
                    <div class="location-mp__map-filter-item">
                        <input id="map2" data-type="education" type="checkbox" class="location__filter-input js-map-filter-input">
                        <label for="map2" class="location__filter-label">
                            <div class="location-mp__map-filter-item-icon">
                                <svg class="icon icon-map2"><use xlink:href="#icon-map2"></use></svg>
                            </div>
                            Образование
                        </label>
                    </div>
                    <div class="location-mp__map-filter-item">
                        <input id="map3" data-type="shop" type="checkbox" class="location__filter-input js-map-filter-input">
                        <label for="map3" class="location__filter-label">
                            <div class="location-mp__map-filter-item-icon">
                                <svg class="icon icon-map3"><use xlink:href="#icon-map3"></use></svg>
                            </div>
                            ­Магазины
                        </label>
                    </div>
                    <div class="location-mp__map-filter-item">
                        <input id="map4" data-type="health" type="checkbox" class="location__filter-input js-map-filter-input">
                        <label for="map4" class="location__filter-label is-active">
                            <div class="location-mp__map-filter-item-icon">
                                <svg class="icon icon-map4"><use xlink:href="#icon-map4"></use></svg>
                            </div>
                            ­Здоровье и красота
                        </label>
                    </div>
                    <div class="location-mp__map-filter-item">
                        <input id="map5" data-type="nutrition" type="checkbox" class="location__filter-input js-map-filter-input">
                        <label for="map5" class="location__filter-label">
                            <div class="location-mp__map-filter-item-icon">
                                <svg class="icon icon-map5"><use xlink:href="#icon-map5"></use></svg>
                            </div>
                            ­Питание
                        </label>
                    </div>
                    <div class="location-mp__map-filter-item">
                        <input id="map6" data-type="entertainment" type="checkbox" class="location__filter-input js-map-filter-input">
                        <label for="map6" class="location__filter-label">
                            <div class="location-mp__map-filter-item-icon">
                                <svg class="icon icon-map6"><use xlink:href="#icon-map6"></use></svg>
                            </div>
                            ­Развлечения
                        </label>
                    </div>
                </div>
            </div>

        </div>
    </div>


</section>
<section class="section section-blockquote">
    <div class="container">
        <div class="section-blockquote__wp content">
            <blockquote>
                <p>Для жителей посёлка доступна вся инфраструктура г. Наро-Фоминска: финтесс-центры, бассейны, парки отдыха, кинотеатры, крупные продуктовые магазины, строительные рынки.</p>
            </blockquote>
        </div>
    </div>
</section>
<section class="genplan js-genplan">
    <div class="container">
        <div class="section__heading">
            <div class="section__title-wp">
                <h2 class="section__title">Генплан</h2>
            </div>
        </div>
        <div class="genplan__desc-wp">
            <div class="genplan__desc">
                <div class="genplan__desc-icon" style="background: #6EA9CE;"></div>
                В продаже
            </div>
            <div class="genplan__desc">
                <div class="genplan__desc-icon" style="background: #959595;"></div>
                Зарезервирован
            </div>
            <div class="genplan__desc">
                <div class="genplan__desc-icon" style="background: #FF0000;"></div>
                Продан
            </div>
        </div>
    </div>
   <div class="genplan__wp">
    <div class="genplan__desc-arrow genplan__desc-arrow--prev">
        <svg class="icon icon-arrow-prev"><use xlink:href="#icon-arrow-prev"></use></svg>
    </div>
    <div class="genplan__desc-arrow genplan__desc-arrow--next">
        <svg class="icon icon-arrow-next"><use xlink:href="#icon-arrow-next"></use></svg>
    </div>
    <div class="genplan__img js-genplan-container">
        <svg class="genplan-area__wp" viewBox="0 0 677.5979 198.96667">
            <path class="genplan-area" fill="none" d="m 411.48068,120.50096 -10.20101,10.27269 20.9885,11.05791 4.64545,-0.1402 7.93146,-9.56793"></path>
            <path class="genplan-area" fill="none" d="m 396.4778,112.71284 15.14623,7.64478 -10.36825,10.41603 -15.57626,-8.17037"></path>
            <path class="genplan-area js-area" data-type="interactive" data-link-area="12" fill="none" d="m 382.28717,105.40251 14.11819,7.4073 -10.57487,9.69644 -14.49398,-7.60174"></path>

            <svg cursor="pointer" class="genplan__circle js-point" data-link-area="12" data-text="Коттедж №38" data-props='{"ДОМ":"159 м2", "Участок":"10 соток"}' data-price="16 000 000 ₽" data-type="interactive" data-balloon="object" x="56%" y="55%" width="30px">
                <circle  cx="5" cy="5" r="4"></circle>
                <text x="5" y="6.4" text-anchor="middle">12</text>
            </svg>
            // Комплекс
            <svg width="17" height="17" viewBox="0 0 61 60" fill="none" data-type="interactive" data-balloon="simple" class="genplan__circle-special js-genplan-circle-special" data-text="Комплекс" x="72%" y="41%">
                <rect x="0.255981" y="-0.00683594" width="60" height="60" rx="30" fill="white"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M25.1991 26.4687C25.0299 27.5809 24.9763 29.5236 25.7404 31.0625C26.5341 32.6611 28.0951 34.2622 28.9973 35.0633C29.0224 35.0946 29.0472 35.1254 29.0715 35.1557L29.0351 35.1565C28.4039 35.1694 27.5326 35.1562 26.572 35.0518C24.6248 34.8402 22.4219 34.2655 21.0476 32.8913C19.6639 31.5076 19.0956 29.5142 18.8863 27.8063C18.7827 26.9602 18.7695 26.2032 18.7824 25.6582C18.7865 25.4831 18.7933 25.3303 18.8006 25.204C18.8883 25.1989 18.9886 25.1941 19.1004 25.1902C19.5522 25.1746 20.1869 25.1748 20.9142 25.2384C22.2438 25.3547 23.8405 25.6791 25.1991 26.4687Z" fill="#1E2633"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M34.651 26.4687C34.8202 27.5809 34.8738 29.5236 34.1097 31.0625C33.316 32.6611 31.755 34.2622 30.8527 35.0633C30.8277 35.0946 30.8029 35.1254 30.7786 35.1557L30.815 35.1565C31.4462 35.1694 32.3175 35.1562 33.2781 35.0518C35.2253 34.8402 37.4282 34.2655 38.8025 32.8913C40.1862 31.5076 40.7545 29.5142 40.9638 27.8063C41.0674 26.9602 41.0806 26.2032 41.0677 25.6582C41.0636 25.4831 41.0568 25.3303 41.0495 25.204C40.9618 25.1989 40.8614 25.1941 40.7497 25.1902C40.2979 25.1746 39.6632 25.1748 38.9359 25.2384C37.6063 25.3547 36.0096 25.6791 34.651 26.4687Z" fill="#1E2633"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M25.0508 36.0688C26.3079 36.2988 27.639 36.2628 28.719 36.1437C28.5658 36.2557 28.4016 36.3702 28.2275 36.4846C27.0809 37.2376 25.55 37.9506 23.9079 37.9266C22.2657 37.9027 20.7631 37.1456 19.6462 36.3596C19.0923 35.9698 18.6449 35.5811 18.3366 35.2904C18.2879 35.2445 18.2428 35.2011 18.2013 35.1606C18.3022 35.0685 18.4239 34.9611 18.5644 34.8433C18.9666 34.5062 19.519 34.0881 20.1783 33.7021C21.1283 34.4534 23.0676 35.7061 25.0508 36.0688Z" fill="#1E2633"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M34.8218 36.0688C33.5648 36.2988 32.2336 36.2628 31.1537 36.1437C31.3068 36.2557 31.471 36.3702 31.6452 36.4846C32.7917 37.2376 34.3226 37.9506 35.9648 37.9266C37.6069 37.9027 39.1095 37.1456 40.2264 36.3596C40.7803 35.9698 41.2277 35.5811 41.536 35.2904C41.5847 35.2445 41.6299 35.2011 41.6713 35.1606C41.5704 35.0685 41.4488 34.9611 41.3083 34.8433C40.906 34.5062 40.3536 34.0881 39.6944 33.7021C38.7444 34.4534 36.805 35.7061 34.8218 36.0688Z" fill="#1E2633"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M30.2685 34.7038C30.1418 34.8247 30.0289 34.9279 29.9344 35.0121C29.8399 34.9279 29.727 34.8247 29.6003 34.7038C29.2058 34.3275 28.6799 33.783 28.1549 33.1114C27.0951 31.7558 26.0875 29.9444 26.0875 27.9875C26.0875 26.0306 27.0951 24.2192 28.1549 22.8636C28.6799 22.192 29.2058 21.6475 29.6003 21.2712C29.727 21.1503 29.8399 21.0471 29.9344 20.9629C30.0289 21.0471 30.1418 21.1503 30.2685 21.2712C30.663 21.6475 31.1889 22.192 31.7139 22.8636C32.7736 24.2192 33.7813 26.0306 33.7813 27.9875C33.7813 29.9444 32.7736 31.7558 31.7139 33.1114C31.1889 33.783 30.663 34.3275 30.2685 34.7038Z" fill="#1E2633"/>
            </svg>
            // Площадка
            <svg width="17" height="17" viewBox="0 0 61 61" fill="none" data-type="interactive" data-balloon="simple" data-text="Площадка" class="genplan__circle-special js-genplan-circle-special" x="46%" y="50%">
                <rect x="0.880981" y="0.584961" width="60" height="60" rx="30" fill="white"/>
                <g clip-path="url(#clip0_1186_43555)">
                <circle cx="30.8901" cy="26.1162" r="2.41403" fill="#1E2633"/>
                <path d="M26.2933 20.3477V27.8542C26.2933 29.355 27.51 30.5717 29.0108 30.5717H32.7796C34.2804 30.5717 35.497 29.355 35.497 27.8542V20.8463" stroke="#1E2633" stroke-width="1.81163"/>
                <path d="M33.0419 44.5684L33.0419 37.9609C33.0419 36.772 32.0781 35.8082 30.8892 35.8082V35.8082C29.7003 35.8082 28.7365 36.772 28.7365 37.9608L28.7365 44.5684" stroke="#1E2633" stroke-width="1.81163"/>
                <path d="M21.5022 45.6351V17.0391" stroke="#1E2633" stroke-width="1.81163"/>
                <path d="M19.0085 20.1982H42.948" stroke="#1E2633" stroke-width="1.81163"/>
                <path d="M40.4543 45.686V17.0391" stroke="#1E2633" stroke-width="1.81163"/>
                <path d="M27.7885 29.7812L33.9394 29.9892V38.6963L32.4396 36.5562H30.8639L29.1872 37.0961L27.7885 39.1327V29.7812Z" fill="#1E2633"/>
                </g>
                <defs>
                <clipPath id="clip0_1186_43555">
                <rect width="30" height="30" fill="white" transform="translate(15.881 15.585)"/>
                </clipPath>
                </defs>
            </svg>
            // Детская площадка
            <svg width="17" height="17" viewBox="0 0 61 61" fill="none" data-type="interactive" data-balloon="simple" data-text="Детская площадка" class="genplan__circle-special js-genplan-circle-special" x="43%" y="45%">
                <rect x="0.255981" y="0.211914" width="60" height="60" rx="30" fill="white"/>
                <path d="M40.8827 35.4277C40.8827 35.4277 38.9349 41.7347 29.6271 41.7347C20.3193 41.7347 18.3715 35.4277 18.3715 35.4277" stroke="#1E2633" stroke-width="1.63517"/>
                <path d="M20.5931 31.935V37.6779L23.1503 40.9058V39.5643C23.1503 36.0683 25.9843 33.2342 29.4803 33.2342C32.9763 33.2342 35.8104 36.0683 35.8104 39.5643V40.9058L37.9064 39.5643V32.27L36.6488 26.9463H22.6472L20.5931 31.935Z" fill="#1E2633"/>
                <rect x="18.8744" y="26.9463" width="4.73704" height="3.14365" fill="#1E2633"/>
                <path d="M41.7213 18.6885H38.4092C33.4084 18.6885 29.3545 22.7424 29.3545 27.7431H36.9004C36.8864 27.1283 36.8668 25.8401 36.9004 25.6053C36.9251 25.4318 37.9289 26.729 38.8176 27.9253C39.3078 28.5853 40.2081 28.7913 40.9307 28.3993L41.0851 28.3156C41.7131 27.9749 42.0473 27.266 41.9103 26.5648L40.986 21.8324H41.7213V18.6885Z" fill="#1E2633"/>
            </svg>
            // КПП
            <svg width="17" height="17" viewBox="0 0 61 61" fill="none" data-type="interactive" data-balloon="simple" data-text="КПП" class="genplan__circle-special js-genplan-circle-special" x="57%" y="88%">
                <rect x="0.255981" y="0.103516" width="60" height="60" rx="30" fill="white"/>
                <path d="M18.302 39.1982C18.302 38.646 18.7497 38.1982 19.302 38.1982H27.3689C27.9212 38.1982 28.3689 38.646 28.3689 39.1982V41.4909H18.302V39.1982Z" fill="#1E2633"/>
                <path d="M19.8928 27.9922C19.8928 27.4399 20.3405 26.9922 20.8928 26.9922H25.7779C26.3301 26.9922 26.7779 27.4399 26.7779 27.9922V38.5158H19.8928V27.9922Z" fill="#1E2633"/>
                <rect x="40.0577" y="19.4045" width="2.79912" height="19.641" transform="rotate(58.4521 40.0577 19.4045)" stroke="#1E2633"/>
                <path d="M38.5138 24.1865L38.3059 20.8223L36.2824 22.0646L36.5174 25.4122L38.5138 24.1865Z" fill="#1E2633"/>
                <path d="M34.3593 26.7363L34.1514 23.3721L32.1279 24.6144L32.3629 27.962L34.3593 26.7363Z" fill="#1E2633"/>
                <path d="M30.2047 29.2881L29.9968 25.9238L27.9733 27.1662L28.2083 30.5138L30.2047 29.2881Z" fill="#1E2633"/>
            </svg>

        </svg>
        <div class="genplan__balloon-simple genplan__balloon js-balloon" data-balloon="simple" data-type="interactive">
            <span class="js-balloon-name">

            </span>
        </div>
        <div class="genplan__balloon-object genplan__balloon js-balloon" data-balloon="object" data-type="interactive">
            <div class="genplan__balloon-head">
                <span class="genplan__balloon-head-name js-balloon-name">

                </span>
            </div>
                <div class="genplan__balloon-body">
                    <div class="genplan__balloon-body-props js-balloon-props">

                    </div>
                    <div class="genplan__balloon-body-footer">
                        <span class="genplan__balloon-body-footer-price js-balloon-price">

                        </span>
                    </div>
            </div>
        </div>

        <img src="./img/content/genplan.png" alt="" class="genplan__img-img">
    </div>
   </div>

</section>
<!-- // Скрипты для генплана -->
<script>
    $(document).ready(function() {

        const map = $('.js-genplan');

        function clearMapState(map) {
            if (map.length) {
                map.find('[data-type=interactive]').removeClass('is-active');
            }
            $('.js-balloon').removeClass('is-active')
        }

        function setArea(object) {
            if (object.data('link-area')) {
                object.hover(() => showBalloon($(`.js-point[data-link-area=${object.data('link-area')}]`)));
            }
        }

        function setColorArea(id) {
            if (id) {
                $(`.js-area[data-link-area=${id}]`).addClass('is-active');
            } else {
                console.log("Укажите id области");
            }
        }

        function setBalloon(object) {
            if (object.length < 1) {
                return false;
            }
            let balloon = getBalloonType(object.data('balloon'));
            if (balloon.length) {
                object.hover(() => showBalloon(object));
            } else {
                console.log("Не найден контейнер bolloon'а");
            }
        }

        function showBalloon(object) {
            let balloon = getBalloonType(object.data('balloon'));
            if (!object.hasClass('is-active')) {
                clearMapState(map);
                object.addClass('is-active');
                balloon.find('.js-balloon-name').text(object.data('text'));
                setBalloonPosition(object, object.data('balloon'));
                if (object.data('link-area'))
                    setColorArea(+object.data('link-area'))
                if (object.data('props') && typeof object.data('props') == 'object')
                    setBalloonProps(object, );
                if (object.data('price'))
                    balloon.find('.js-balloon-price').text(object.data('price'));

            } else {
                clearMapState(map);
            }
        }
        function getBalloonType(name) {
            if (name.length && $(`.js-balloon[data-balloon=${name}]`)) {
                return $(`.js-balloon[data-balloon=${name}]`);
            } else {
                console.log("Не указано имя bolloon'а");
            }
        }

        function setBalloonProps(object) {
            let propsObject = object.data('props');
            let balloon = getBalloonType(object.data('balloon'));
            if (propsObject) {
                let props = `<div class="genplan__balloon-body-row">`;
                for (let item in propsObject) {
                    props += `<div class="genplan__balloon-body-item">
                                <span class="genplan__balloon-body-item-name">
                                   ${item}
                                </span>
                                <span class="genplan__balloon-body-item-value">
                                    ${propsObject[item]}
                                </span>
                            </div>`;
                    }
                    props += `</div>`;
                    balloon.find('.js-balloon-props').html(props);
            }
        }

        function setBalloonPosition(elem, type) {
            let balloon = getBalloonType(type),
            point = elem;

            if (balloon.length && point.length) {
                let pointLeft = point.position().left,
                    pointHeight = point.height(),
                    pointPositionTop = point.position().top,
                    balloonWidth = balloon.outerWidth(),
                    balloonHeight = balloon.outerHeight(),
                    containerScrollPosition = point.parents('.js-genplan-container').scrollLeft(),
                    containerTopPosition = point.parents('.js-genplan-container').offset().top;

                // Устанавливаем позицию элемента по X
                balloon.css('left', Math.floor(pointLeft + containerScrollPosition) -  balloonWidth);

                // Устанавливаем позицию элемента по Y
                balloon.css('top',  Math.floor((pointPositionTop - containerTopPosition) + ((pointHeight - balloonHeight) / 2)));

                // Устанавливаем класс активности после пересчета позиции
                balloon.addClass('is-active');
            }
        }
        $('[data-balloon]').each(function() {
            setBalloon($(this));
        });

        $('.js-area').each(function() {
            if ($(this).data('link-area'))
                setArea($(this));
        });


    });
</script>
<!-- // MAP -->
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
<script>
    $(function () {
        if ($('#map').length) {
            var markers = [[  55.753544, 37.121202], [  55.713144, 35.601102] , [  55.793500, 37.621102] , [  54.913645, 37.404752] , [  54.933652, 37.446416] ];
            var data = [
                {
                    "NAME": "Школа №6",
                    "PROPERTY_ICON": "./img/svg/metka2-shop.svg",
                    "PROPERTY_DESC_VALUE": "Образование",
                    "PROPERTY_ADDRESS_VALUE": "г. Мытищи,Волковское шоссе, вл. 5а, стр.1, офис 502бц «Волковский»",
                    "PROPERTY_PHONE_VALUE": ["+7(495)226-07-62", "+7(495)226-07-61"],
                    "PROPERTY_MAIL_VALUE": "info@dushlux.ru",
                    "PROPERTY_LINK_VALUE": "dushlux.ru",
                    "ID": 0,
                    "CITY": 1,
                    "PROPERTY_TYPE_VALUE": "shop",
                },
                {
                    "NAME": "Dushlux",
                    "PROPERTY_ADDRESS_VALUE": "г. Мытищи,Волковское шоссе, вл. 5а, стр.1, офис 502бц «Волковский»",
                    "PROPERTY_PHONE_VALUE": "+7(495)226-07-62",
                    "PROPERTY_MAIL_VALUE": "info@dushlux.ru",
                    "PROPERTY_LINK_VALUE": "dushlux.ru",
                    "ID": 1,
                    "CITY": 1,
                    "PROPERTY_TYPE_VALUE": "education",
                },
                {
                    "NAME": "Dushlux",
                    "PROPERTY_ADDRESS_VALUE": "г. Мытищи,Волковское шоссе, вл. 5а, стр.1, офис 502бц «Волковский»",
                    "PROPERTY_PHONE_VALUE": "+7(495)226-07-62",
                    "PROPERTY_MAIL_VALUE": "info@dushlux.ru",
                    "PROPERTY_LINK_VALUE": "dushlux.ru",
                    "ID": 2,
                    "CITY": 1,
                    "PROPERTY_TYPE_VALUE": "nutrition",
                },
                {
                    "NAME": "Dushlux",
                    "PROPERTY_ADDRESS_VALUE": "г. Мытищи,Волковское шоссе, вл. 5а, стр.1, офис 502бц «Волковский»",
                    "PROPERTY_PHONE_VALUE": "+7(495)226-07-62",
                    "PROPERTY_MAIL_VALUE": "info@dushlux.ru",
                    "PROPERTY_LINK_VALUE": "dushlux.ru",
                    "ID": 3,
                    "CITY": 1,
                    "PROPERTY_TYPE_VALUE": "health",
                },
                {
                    "NAME": "Dushlux",
                    "PROPERTY_ADDRESS_VALUE": "г. Мытищи,Волковское шоссе, вл. 5а, стр.1, офис 502бц «Волковский»",
                    "PROPERTY_PHONE_VALUE": "+7(495)226-07-62",
                    "PROPERTY_MAIL_VALUE": "info@dushlux.ru",
                    "PROPERTY_LINK_VALUE": "dushlux.ru",
                    "ID": 4,
                    "CITY": 2,
                    "PROPERTY_TYPE_VALUE": "sport",
                },
                {
                    "NAME": "Dushlux",
                    "PROPERTY_ADDRESS_VALUE": "г. Мытищи,Волковское шоссе, вл. 5а, стр.1, офис 502бц «Волковский»",
                    "PROPERTY_PHONE_VALUE": "+7(495)226-07-62",
                    "PROPERTY_MAIL_VALUE": "info@dushlux.ru",
                    "PROPERTY_LINK_VALUE": "dushlux.ru",
                    "ID": 5,
                    "CITY": 2,
                    "PROPERTY_TYPE_VALUE": "entertainment",
                },
            ];

            // Константы ключей и свойств для построения карты

            const keyPropertyType = "PROPERTY_TYPE_VALUE", //Ключ свойства определяющего тип метки
            // Опции для иконок меток
            pointOptions = {
                education: {
                    balloonOffset: [83, -35],
                    iconLayout: 'default#image',
                    iconImageHref: './img/svg/metka1-ed.svg',
                    iconImageSize: [55, 55],
                    iconImageOffset: [-25, -25],
                },
                shop: {
                    balloonOffset: [83, -35],
                    iconLayout: 'default#image',
                    iconImageHref: './img/svg/metka2-shop.svg',
                    iconImageSize: [55, 55],
                    iconImageOffset: [-27, -27],
                },
                entertainment: {
                    balloonOffset: [83, -35],
                    iconLayout: 'default#image',
                    iconImageHref: './img/svg/metka5-enter.svg',
                    iconImageSize: [55, 55],
                    iconImageOffset: [-27, -27],
                },
               sport: {
                balloonOffset: [83, -35],
                iconLayout: 'default#image',
                iconImageHref: './img/svg/metka-sport.svg',
                iconImageSize: [55, 55],
                iconImageOffset: [-27, -27],
               },
               health: {
                    balloonOffset: [83, -35],
                    iconLayout: 'default#image',
                    iconImageHref: './img/svg/metka3-health.svg',
                    iconImageSize: [55, 55],
                    iconImageOffset: [-27, -27],
               },
               nutrition: {
                balloonOffset: [83, -35],
                iconLayout: 'default#image',
                iconImageHref: './img/svg/metka4-nutri.svg',
                iconImageSize: [55, 55],
                iconImageOffset: [-27, -27],
               },
               default: {
                balloonOffset: [83, -35],
                iconLayout: 'default#image',
                iconImageHref: './img/svg/metka.svg',
                iconImageSize: [55, 55],
                iconImageOffset: [-27, -27],
               }
            }



            var mapHeight = $('#map').height();

            ymaps.ready(function () {

                var contactsMap = new ymaps.Map("map", {
                        center:  [55.30954, 37.721587],
                        zoom: 8,
                        behaviors: ['default'],
                        controls: [],

                    }),

                    MyIconContentLayout = ymaps.templateLayoutFactory.createClass(
                        '<span style="font-weight: 600;font-size: 15px; color: #000">{{ properties.geoObjects.length }}</span>'
                    ),

                    objectManager = new ymaps.ObjectManager({
                        clusterize: true,
                        clusterIcons: [
                            {
                                href: './img/svg/claster-small.svg',
                                size: [40, 40],
                                offset: [-20, -20],
                                iconContentOffset: [20, 20],
                                shape: {
                                    type: 'Circle',
                                    coordinates: [0, 0],
                                    radius: 20
                                }
                            },
                        ],
                        margin: 100,
                        zoomMargin: 200,
                        clusterNumbers: [3],
                        // clusterDisableClickZoom: true,
                        hasBallon: false,
                        hasHint: false,
                        openBalloonOnClick: true,
                        clusterIconContentLayout: MyIconContentLayout
                    });

            contactsMap.options.set('maxAnimationZoomDifference', Infinity);
            function getPointOptions(name) {
                if (name in pointOptions) {
                    return pointOptions[name];
                } else {
                    return alert(`Свойство ${name} не найдено. Задайте опции метки в объекте pointOptions!`);
                }
            }

            function setTypePoint(object) {
                let type = '',
                pointProps = Object;
                if ("type" in object.properties) {
                    type = object.properties.type;
                } else if ("default" in pointOptions){
                    type = 'default';
                } else {
                    return alert(`Для объекта с id ${object.id} задан некорректный тип!`);
                }

                if ("options" in object) {
                    pointProps = getPointOptions(type);
                    for (prop in pointProps) {
                        object.options[prop] = pointProps[prop];
                    }
                }
                return object;
            }




                var MyBalloonLayout = ymaps.templateLayoutFactory.createClass(
                    '<div class="popover">' +
                    '<div class="popover__arrow"></div>' +
                    '<div class="popover__inner">' +
                    '<a class="popover__close" href="#">' +
                    '<svg class="icon icon-close-big">' +
                    '<use xlink:href="#icon-close-big"></use>' +
                    '</svg>' +
                    '</a>' +
                    '$[[options.contentLayout observeSize minWidth=300 maxWidth=480]]' +
                    '<span class="popover__tail"></span>' +
                    '</div>' +
                    '</div>', {
                        build: function () {
                            this.constructor.superclass.build.call(this);

                            this._$element = $('.popover', this.getParentElement());

                            this.applyElementOffset();

                            this._$element.find('.popover__close')
                                .on('click', $.proxy(this.onCloseClick, this));
                        },
                        clear: function () {
                            this._$element.find('.popover__close')
                                .off('click');

                            this.constructor.superclass.clear.call(this);
                        },
                        onSublayoutSizeChange: function () {
                            MyBalloonLayout.superclass.onSublayoutSizeChange.apply(this, arguments);

                            if (!this._isElement(this._$element)) {
                                return;
                            }

                            this.applyElementOffset();

                            this.events.fire('shapechange');
                        },
                        applyElementOffset: function () {
                            this._$element.css({
                                left: -(this._$element[0].offsetWidth / 2.2),
                                top: -(this._$element[0].offsetHeight + this._$element.find('.popover__arrow')[0].offsetHeight)
                            });
                        },
                        onCloseClick: function (e) {
                            e.preventDefault();

                            this.events.fire('userclose');
                        },
                        getShape: function () {
                            if (!this._isElement(this._$element)) {
                                return MyBalloonLayout.superclass.getShape.call(this);
                            }

                            var position = this._$element.position();

                            return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([
                                [position.left, position.top], [
                                    position.left + this._$element[0].offsetWidth,
                                    position.top + this._$element[0].offsetHeight + this._$element.find('.popover__arrow')[0].offsetHeight
                                ]
                            ]));
                        },
                        _isElement: function (element) {
                            return element && element[0] && element.find('.popover__arrow')[0];
                        }
                    });

                var MyBalloonContentLayout = ymaps.templateLayoutFactory.createClass(
                    '<div class="popover__content">$[properties.balloonContent]</div>'
                );

                contactsMap.behaviors.disable(['scrollZoom']);

                var collection = {
                    type: "FeatureCollection",
                    features: []
                };

                for (var i = 0; i < markers.length; i++) {
                    var marker = markers[i];
                    var item = data[i];
                    var phones = '';
                    // Поправь ключи массив в зависимости от компонента
                    if (Array.isArray(data[i].PROPERTY_PHONE_VALUE)) {
                        data[i].PROPERTY_PHONE_VALUE.forEach(item => {
                            phones += `<a href="tel:${item.replace(/[^\d]/g,'')}">${item}</a>`
                        });
                    } else {
                        phones = `<a href="tel:${data[i].PROPERTY_PHONE_VALUE.replace(/[^\d]/g,'')}">${data[i].PROPERTY_PHONE_VALUE}</a>`
                    }

                    var balloon = `
                   <div class="ballon">
                        <div class="ballon__head">
                           <div class="baloon__head-text">
                               ${data[i].NAME}
                           </div>
                       </div>
                       <div class="baloon__body">
                           <div class="baloon__props">
                               <div style="${data[i].PROPERTY_DESC_VALUE ? '' : 'display:none'}" class="baloon__line">
                                    <span class="baloon__line-icon">
                                        <img src="${item.PROPERTY_ICON}" alt="${item.PROPERTY_DESC_VALUE}" title="${item.PROPERTY_DESC_VALUE}">
                                    </span>
                                   <span>${item.PROPERTY_DESC_VALUE}</span>
                               </div>
                               <div style="${data[i].PROPERTY_PHONE_VALUE ? '' : 'display:none'}" class="baloon__line">
                                   <svg class="icon icon-map-phone"><use xlink:href="#icon-map-phone"></use></svg>
                                   ${phones}
                               </div>
                                <div style="${data[i].PROPERTY_MAIL_VALUE ? '' : 'display:none'}" class="baloon__line">
                                   <svg class="icon icon-map-mail"><use xlink:href="#icon-map-mail"></use></svg>
                                    <a href="mailto:${item.PROPERTY_MAIL_VALUE}">${item.PROPERTY_MAIL_VALUE}</a>
                               </div>
                               <div style="${data[i].PROPERTY_LINK_VALUE ? '' : 'display:none'}" class="baloon__line">
                                   <svg class="icon icon-map-geo"><use xlink:href="#icon-map-geo"></use></svg>
                                   <a href="${item.PROPERTY_LINK_VALUE}">${item.PROPERTY_LINK_VALUE}</a>
                               </a>
                           </div>
                       </div>
                   </div>
                   `;

                    collection.features.push(
                        setTypePoint(
                        {
                            type: 'Feature',
                            id: i,
                            geometry: {
                                type: 'Point',
                                coordinates: marker,
                                options: {
                                    pixelRendering: "static"
                                }
                            },
                            properties: {
                                balloonContent: balloon,
                                hintContent: item.NAME,
                                type: item[keyPropertyType]
                            },
                            options: {
                                balloonLayout: MyBalloonLayout,
                                balloonContentLayout: MyBalloonContentLayout,
                            }
                        }
                    )
                    )
                }
                objectManager.add(collection)

                contactsMap.geoObjects.add(objectManager);

                contactsMap.controls.add('zoomControl', {
                    size: 'small',
                    float: 'none',
                    position: {
                        top: mapHeight / 2 - 30,
                        right: '45px'
                    }
                });



            function setState () {

                let filter = new Array,
                filterQuery = '';

                if ($(".js-map-filter-input:checked").length >= 1) {
                    $(".js-map-filter-input:checked").each(function() {
                        filter.push(`properties.type == '${$(this).data('type')}'`);
                    });
                    if (filter.length > 1) {
                        filterQuery = filter.join(' || ');
                    } else {
                        filterQuery = filter[0];
                    }
                    objectManager.setFilter(filterQuery);

                } else {
                    objectManager.setFilter();
                }

                contactsMap.setBounds(contactsMap.geoObjects.getBounds(),
                    {checkZoomRange:true, zoomMargin:100}).then(function(){ if(contactsMap.getZoom() > 14) contactsMap.setZoom(14);});
            }

            $('.location__filter-input').click(setState);


                contactsMap.setBounds(contactsMap.geoObjects.getBounds(),
                    {checkZoomRange:true, zoomMargin:100}).then(function(){ if(contactsMap.getZoom() > 14) contactsMap.setZoom(14);});
            });

        }

    });

</script>
@@include('include/footer.html')